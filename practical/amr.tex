\documentclass[11pt]{article}
\usepackage{sectsty}
\allsectionsfont{\color{blue}\fontfamily{lmss}\selectfont}
\usepackage{fontspec}
\setmainfont{XCharter}

\usepackage{listings}
\lstset{
basicstyle=\small\ttfamily,
tabsize=8,
columns=flexible,
breaklines=true,
frame=tb,
rulecolor=\color[rgb]{0.8,0.8,0.7},
backgroundcolor=\color[rgb]{1,1,0.91},
postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}}
}
\usepackage{fontawesome}


\usepackage{mdframed}
\newmdenv[
  backgroundcolor=gray,
  fontcolor=white,
  nobreak=true,
]{terminalinput}



\usepackage{parskip}


    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)


    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}



    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}


    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{index}





% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }



    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults

    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}



\renewcommand{\PY}[2]{{#2}}
\usepackage{fancyhdr}
\pagestyle{fancy}
\rhead{\color{gray}\sf\small\rightmark}
\lhead{\nouppercase{\color{gray}\sf\small\leftmark}}
\cfoot{\color{gray}\sf\thepage}
\renewcommand{\footrulewidth}{1pt}
\begin{document}





    \hypertarget{antimicrobial-resistance-identification-using-ariba}{%
\section{Antimicrobial resistance identification using
ARIBA}\label{antimicrobial-resistance-identification-using-ariba}}

\hypertarget{introduction}{%
\subsection{Introduction}\label{introduction}}

ARIBA is a tool that can be used to identify the prescence/abscence of a
set of genes and their variants in a sample. In particular, it was
designed to detect and identify antibiotic resistance genes. This
tutorial will walk you through the analysis of the \textit{Neisseria
gonorrhoeae} data set used in the ARIBA paper:

\begin{quote}
\textbf{ARIBA: rapid antimicrobial resistance genotyping directly from
sequencing reads}\\
Hunt M, Mather AE, Sánchez-Busó L, Page AJ, Parkhill J , Keane JA,
Harris SR.\\
\textit{Microbial Genomics 2017. doi: 110.1099/mgen.0.000131}\\
PMID:
\href{https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5695208/}{29177089}
\end{quote}

A copy of the paper can be found at

\texttt{/course\_data/amr/ariba\_paper.pdf}

\hypertarget{learning-outcomes}{%
\subsection{Learning outcomes}\label{learning-outcomes}}

By the end of this tutorial you can expect to be able to:

\begin{itemize}
\tightlist
\item
  Use ARIBA to detect the prescence/abscence of a set of genes
\item
  Download and prepare the standard AMR databases for use with ARIBA
\item
  Run ARIBA on several samples to identify antibiotic resistance
\item
  Prepare and use your own database for use with ARIBA
\item
  Summarise ARIBA results for several samples
\item
  Query the AMR results produced by ARIBA
\item
  Use Phandango to visualise ARIBA results
\end{itemize}

\hypertarget{tutorial-sections}{%
\subsection{Tutorial sections}\label{tutorial-sections}}

This tutorial comprises the following sections:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{basic_ariba.ipynb}{Detect prescence/abscence of a set of genes
  with ARIBA}
\item
  \href{standard_ariba.ipynb}{Use a standard AMR database with ARIBA}
\item
  \href{make_custom_db.ipynb}{Prepare a custom reference database for
  ARIBA}
\item
  \href{run_ariba.ipynb}{Run ARIBA using a custom reference database}
\item
  \href{phandango.ipynb}{View summarized results using Phandango}
\item
  \href{micplot.ipynb}{Investigate MIC data in relation to variants in
  the samples}
\end{enumerate}

\hypertarget{authors}{%
\subsection{Authors}\label{authors}}

This tutorial was created by
\href{https://github.com/jacquikeane}{Jacqui Keane} and
\href{https://github.com/martinghunt}{Martin Hunt}.

    \hypertarget{running-commands-in-this-tutorial}{%
\subsubsection{Running commands in this
tutorial}\label{running-commands-in-this-tutorial}}

You can follow this tutorial by running all the commands provided on the
\texttt{bioinfsrv} server. To get started, connect to the
\texttt{bioinfsrv} server using the instructions provided earlier and
type all the commands you see into the terminal window. Remember, the
terminal window is similar to the ``Command Prompt'' window on MS
Windows systems, which allows the user to type DOS commands to manage
files.

Start by typing the command below:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{cd}\PY{+w}{ }\PYZti{}/course\PYZus{}data/amr/data
\end{Verbatim}
\end{tcolorbox}

    Now you can follow the instructions in the tutorial from here.

\hypertarget{lets-get-started}{%
\subsection{Let's get started!}\label{lets-get-started}}

This tutorial uses the ARIBA software application. It has already been
installed on the server you are using for this training course. To
activate the ARIBA environment and check that the software is installed
correctly, run the following command:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
conda\PY{+w}{ }activate\PY{+w}{ }ariba\PYZhy{}2.14.6
ariba\PY{+w}{ }\PYZhy{}\PYZhy{}help
\end{Verbatim}
\end{tcolorbox}

    This should return the following help message:

\begin{verbatim}
usage: ariba <command> <options>

ARIBA: Antibiotic Resistance Identification By Assembly

optional arguments:
  -h, --help      show this help message and exit

Available commands:

    aln2meta      Converts multi-aln fasta and SNPs to metadata
    expandflag    Expands flag column of report file
    flag          Translate the meaning of a flag
    getref        Download reference data
    micplot       Make violin/dot plots using MIC data
    prepareref    Prepare reference data for input to "run"
    pubmlstget    Download species from PubMLST and make db
    pubmlstspecies
                  Get list of available species from PubMLST
    refquery      Get cluster or sequence info from prepareref output
    run           Run the local assembly pipeline
    summary       Summarise multiple reports made by "run"
    test          Run small built-in test dataset
    version       Get versions and exit
\end{verbatim}

For download and installation instructions for ARIBA, please see the
\href{https://github.com/sanger-pathogens/ariba}{ARIBA GitHub-page at
https://github.com/sanger-pathogens/ariba}.

To get started with the tutorial, head to the first section:
\href{basic_ariba.ipynb}{Detect prescence/abscence of genes with ARIBA}


    % Add a bibliography block to the postdoc



\newpage





    \hypertarget{detect-prescenceabscence-of-genes-with-ariba}{%
\section{Detect prescence/abscence of genes with
ARIBA}\label{detect-prescenceabscence-of-genes-with-ariba}}

One of the most basic tasks ARIBA can be used for is to detect the
presence or abscence of a set genes. Let us look at an example. But
first, let's check that you're in the right place. Type the command
below in the terminal window followed by the Enter key:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{pwd}
\end{Verbatim}
\end{tcolorbox}

    It should display something like:

\texttt{/home/username/course\_data/amr/data}

    Ok, back to the example! We have sequence data for 3 Neisseria
gonorrhoeae samples and want to determine if the genes \texttt{fitA} and
\texttt{fbpA} are present or absent in these samples. Let us use ARIBA
to determine this from the raw sequence data.

First list the fastq files for the samples.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls\PY{+w}{ }fastq
\end{Verbatim}
\end{tcolorbox}

    For the purpose of this exercise, we have created a fasta file
containing the sequences of the genes \texttt{fitA} and \texttt{fbpA},
take a look:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{cd}\PY{+w}{ }basic
ls
cat\PY{+w}{ }genes.fasta
\end{Verbatim}
\end{tcolorbox}

    Running ARIBA is generally a three stage process: * prepare a reference
database * run ariba on each sample * summmarise the ariba results for
all samples

    First prepare the reference database:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }prepareref\PY{+w}{ }\PYZhy{}f\PY{+w}{ }genes.fasta\PY{+w}{ }\PYZhy{}\PYZhy{}all\PYZus{}coding\PY{+w}{ }yes\PY{+w}{ }out
\end{Verbatim}
\end{tcolorbox}

    Next, run ariba for all 3 samples

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }run\PY{+w}{ }out\PY{+w}{ }../fastq/ERR1067813\PYZus{}1.fastq.gz\PY{+w}{ }../fastq/ERR1067813\PYZus{}2.fastq.gz\PY{+w}{ }ariba\PYZus{}results\PYZus{}ERR1067813
ariba\PY{+w}{ }run\PY{+w}{ }out\PY{+w}{ }../fastq/ERR1067814\PYZus{}1.fastq.gz\PY{+w}{ }../fastq/ERR1067814\PYZus{}2.fastq.gz\PY{+w}{ }ariba\PYZus{}results\PYZus{}ERR1067814
ariba\PY{+w}{ }run\PY{+w}{ }out\PY{+w}{ }../fastq/ERR1067815\PYZus{}1.fastq.gz\PY{+w}{ }../fastq/ERR1067815\PYZus{}2.fastq.gz\PY{+w}{ }ariba\PYZus{}results\PYZus{}ERR1067815
\end{Verbatim}
\end{tcolorbox}

    Next, summarise the results:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }all\PYZus{}samples\PY{+w}{ }ariba\PYZus{}results*/*.tsv
\end{Verbatim}
\end{tcolorbox}

    Now inspect the results:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
cat\PY{+w}{ }all\PYZus{}samples.csv
\end{Verbatim}
\end{tcolorbox}

    Notice that the original gene names are not present in the summary file,
instead we have the cluster names cluster, cluster\_1 etc. This is
because ARIBA gathers together genes that are similar into clusters.

To determine which genes are in which cluster run:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }refquery\PY{+w}{ }out\PY{+w}{ }cluster\PY{+w}{ }cluster
ariba\PY{+w}{ }refquery\PY{+w}{ }out\PY{+w}{ }cluster\PY{+w}{ }cluster\PYZus{}1
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{exercises}{%
\subsection{Exercises}\label{exercises}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  How many samples have the fitA gene?
\item
  How many samples have the fbpA gene?
\end{enumerate}

    Now go to the next part of the tutorial where we
\href{standard_ariba.ipynb}{use a standard database with ARIBA to
determine AMR}.


    % Add a bibliography block to the postdoc



\newpage





    \hypertarget{use-a-standard-amr-database-with-ariba}{%
\section{Use a standard AMR database with
ARIBA}\label{use-a-standard-amr-database-with-ariba}}

This sections shows you how to run ARIBA on several samples to determine
the presence of AMR genes using standard public AMR databases.

    Make a new directory \texttt{standard} and move into that directory:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{cd}\PY{+w}{ }..
mkdir\PY{+w}{ }standard
\PY{n+nb}{cd}\PY{+w}{ }standard
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{reference-database}{%
\subsection{Reference database}\label{reference-database}}

We are going to download and prepare a reference database for use with
ARIBA. You can use any one of the
\href{https://github.com/sanger-pathogens/ariba/wiki/Task:-getref}{standard
reference databases that ARIBA supports}

\begin{itemize}
\tightlist
\item
  ARG-ANNOT. PMID: 24145532
\item
  CARD. PMID: 23650175
\item
  MEGARes PMID: 27899569
\item
  NCBI BioProject: PRJNA313047
\item
  plasmidfinder PMID: 24777092
\item
  resfinder. PMID: 22782487
\item
  VFDB. PMID: 26578559
\item
  SRST2's version of ARG-ANNOT. PMID: 25422674.
\item
  VirulenceFinder PMID: 24574290.
\end{itemize}

Let's use the CARD database. Run these commands to make an ARIBA
database directory called \texttt{ariba\_card\_db}:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }getref\PY{+w}{ }card\PY{+w}{ }out.card
ariba\PY{+w}{ }prepareref\PY{+w}{ }\PYZhy{}f\PY{+w}{ }out.card.fa\PY{+w}{ }\PYZhy{}m\PY{+w}{ }out.card.tsv\PY{+w}{ }ariba\PYZus{}card\PYZus{}db
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{how-to-run-on-one-sample}{%
\subsection{How to run on one sample}\label{how-to-run-on-one-sample}}

To run ARIBA on one of the \textit{Neisseria gonorrhoeae} samples and the
card database, you need to supply the database directory we prepared
earlier (which we have called \texttt{ariba\_card\_db}) and two
sequencing reads files \texttt{fastq/ERR1067813\_1.fastq.gz},
\texttt{fastq/ERR1067813\_2.fastq.gz}.

The command to run ARIBA is:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }run\PY{+w}{ }ariba\PYZus{}card\PYZus{}db\PY{+w}{ }../fastq/ERR1067813\PYZus{}1.fastq.gz\PY{+w}{ }../fastq/ERR1067813\PYZus{}2.fastq.gz\PY{+w}{ }ariba.ERR1067813
\end{Verbatim}
\end{tcolorbox}

    The above command will make a new directory called
\texttt{ariba.ERR1067813} that will contain the ariba results.

    \hypertarget{run-on-all-samples}{%
\subsection{Run on all samples}\label{run-on-all-samples}}

But what if we want to run ARIBA on all 3 samples? This can be done with
a ``for'' loop. We assume that the reads files are named like this:

\begin{verbatim}
ERR1067813_1.fastq.gz ERR1067813_2.fastq.gz
ERR1067814_1.fastq.gz ERR1067814_2.fastq.gz
ERR1067815_1.fastq.gz ERR1067815_2.fastq.gz
\end{verbatim}

Then we can run ARIBA on all samples like this (you may need to edit
this command depending on how your own files are named):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{for}\PY{+w}{ }sample\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{l+s+sb}{`}ls\PY{+w}{ }../fastq/*\PYZus{}1.fastq.gz\PY{+w}{ }\PY{p}{|}\PY{+w}{ }sed\PY{+w}{ }\PY{l+s+s1}{\PYZsq{}s/..\PYZbs{}/fastq\PYZbs{}///\PYZsq{}}\PY{+w}{ }\PY{p}{|}\PY{+w}{ }sed\PY{+w}{ }\PY{l+s+s1}{\PYZsq{}s/\PYZbs{}\PYZus{}1.fastq.gz//\PYZsq{}}\PY{l+s+sb}{`}
\PY{k}{do}
\PY{+w}{    }ariba\PY{+w}{ }run\PY{+w}{ }ariba\PYZus{}card\PYZus{}db\PY{+w}{ }../fastq/\PY{l+s+si}{\PYZdl{}\PYZob{}}\PY{n+nv}{sample}\PY{l+s+si}{\PYZcb{}}\PYZus{}1.fastq.gz\PY{+w}{ }../fastq/\PY{l+s+si}{\PYZdl{}\PYZob{}}\PY{n+nv}{sample}\PY{l+s+si}{\PYZcb{}}\PYZus{}2.fastq.gz\PY{+w}{ }ariba.\PY{l+s+si}{\PYZdl{}\PYZob{}}\PY{n+nv}{sample}\PY{l+s+si}{\PYZcb{}}
\PY{k}{done}
\end{Verbatim}
\end{tcolorbox}

    The output directory of each sample is called \texttt{ariba.\$sample},
for example ariba.ERR1067813 is the output directory for sample
ERR1067813.

    \hypertarget{ariba-output}{%
\subsection{ARIBA output}\label{ariba-output}}

While you are waiting for ARIBA to run on all 3 samples, go to the
\href{https://github.com/sanger-pathogens/ariba/wiki/Task:-run}{ARIBA
wiki (https://github.com/sanger-pathogens/ariba/wiki/Task:-run} and read
about the ARIBA output and what each of the columns in the report.tsv
output file mean.

    \hypertarget{summarising-the-results}{%
\subsection{Summarising the results}\label{summarising-the-results}}

Now gather together the results

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }all\PYZus{}results\PY{+w}{ }ariba.*/report.tsv
\end{Verbatim}
\end{tcolorbox}

    Look at the files produced by ariba summary:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls
\end{Verbatim}
\end{tcolorbox}

    You should see 3 files:

\texttt{all\_results.csv} \texttt{all\_results.phandango.csv}
\texttt{all\_results.phandango.tre}

Now look at the file all\_results.csv and answer the questions below.

    \hypertarget{exercises}{%
\subsection{Exercises}\label{exercises}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Which AMR genes are present in all 3 samples?
\item
  Which AMR genes are absent in sample ERR1067813 but present in the
  other two samples?
\item
  Which AMR genes are absent in sample ERR1067814 but present in the
  other two samples?
\item
  Which AMR genes are absent in sample ERR1067815 but present in the
  other two samples?
\end{enumerate}

    Now go to the next part of the tutorial where we
\href{make_custom_db.ipynb}{prepare a custom reference database for
ARIBA}.


    % Add a bibliography block to the postdoc



\newpage





    \hypertarget{prepare-a-custom-reference-database-for-ariba}{%
\section{Prepare a custom reference database for
ARIBA}\label{prepare-a-custom-reference-database-for-ariba}}

For the \textit{N. gonorrhoeae} data from the ARIBA manuscript, we were
also interested in particular sequences and SNPs. This means using
custom reference data as opposed to one of the public reference sets
like in the previous section.

We were interested in several reference sequences, some of which are
coding seqeunces and others are not, and particular variants in those
sequences. The idea is to generate input files to ARIBA that contain all
the sequences and variants of interest, using the ARIBA function
\href{https://github.com/sanger-pathogens/ariba/wiki/Task:-aln2meta}{aln2meta}.

First, let's change to the directory with the reference data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{cd}\PY{+w}{ }../Ref/
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{using-one-reference-sequence}{%
\subsection{Using one reference
sequence}\label{using-one-reference-sequence}}

We start by describing \textit{folP}, but the method is (nearly) the same
for all other sequences.

There are several alleles of \textit{folP} and we want to include them all
in the ARIBA database. We have a SNP of interest R228S in the sequence
in the allele called ``folP.WHO\_F\_01537c'', which confers resistance
to sulphonamides. When we run ARIBA, a particular sample may have a
different allele from folP.WHO\_F\_01537c, but we would still like to
know whether it has the SNP R228S. However, the position may not be 228
because of insertion or deletions. So we use a multiple alignment of all
the reference alleles, and just supply the SNP to ARIBA in one of the
alleles, in this case folP.WHO\_F\_01537c.

The ``aln2meta'' function of ARIBA needs two input files: a multiple
alignment file of the alleles, and a tab-delimited file of the SNPs of
interest. In this case, the SNPs file simply contains one line:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
cat\PY{+w}{ }aln2meta\PYZus{}input/folP\PYZus{}in.tsv
\end{Verbatim}
\end{tcolorbox}

    There are four columns:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Sequence name
\item
  SNP (an amino acid change at position 228, where R is the wild type
  and S is the variant)
\item
  A ``group name'' for this SNP. This is optional and a dot ``.'' means
  no group name. Putting SNPs into the same group allows ARIBA to report
  them together later on.
\item
  A description of the SNP. This will appear in ARIBA's output files to
  save looking up the reason the SNP is of interest.
\end{enumerate}

This file is used together with the mulitple alignment file to generate
input files to ARIBA when making the database. This is the command to
run:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }aln2meta\PY{+w}{ }\PYZhy{}\PYZhy{}variant\PYZus{}only\PY{+w}{ }aln2meta\PYZus{}input/folP.aln\PY{+w}{ }aln2meta\PYZus{}input/folP\PYZus{}in.tsv\PY{+w}{ }coding\PY{+w}{ }aln2meta\PYZus{}output/folP
\end{Verbatim}
\end{tcolorbox}

    A few things to note about the above command:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The option \texttt{-\/-variant\_only} was used, which affects how
  ARIBA reports later on when summarizing across all samples. We are
  only interested in this gene being present if it has a variant that
  causes resistance.
\item
  \texttt{aln2meta\_input/folP.aln} is the name of the multiple
  alignment file.
\item
  The sequence is ``coding'', which makes ARIBA treat it as such, in
  particular it will interpret the variant R228S as an amino acid change
  at position 228 in the translated amino acid sequence. The input
  sequence is still in nucleotides, not amino acids.
\item
  The command output three files, which can be used as input to the
  command \texttt{ariba\ prepareref} (see later).
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls\PY{+w}{ }aln2meta\PYZus{}output/folP*
\end{Verbatim}
\end{tcolorbox}

    Although we have many more reference sequences of interest to deal with
for the complete analysis, for illustrative purposes here we can use the
three files \texttt{aln2meta\_output/folP*} to make an ARIBA reference
database:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }prepareref\PY{+w}{ }\PYZhy{}f\PY{+w}{ }aln2meta\PYZus{}output/folP.fa\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZhy{}m\PY{+w}{ }aln2meta\PYZus{}output/folP.tsv\PY{+w}{ }\PYZhy{}\PYZhy{}cdhit\PYZus{}clusters\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }aln2meta\PYZus{}output/folP.cluster\PY{+w}{ }test.aribadb
\end{Verbatim}
\end{tcolorbox}

    This made an ARIBA database of just those sequences and the SNP R228S in
a new directory called \texttt{test.aribadb}. Let's check that it was
made:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls\PY{+w}{ }test.aribadb
\end{Verbatim}
\end{tcolorbox}

    You do not need to worry about the contents of the new directory
\texttt{test.aribadb}, just know that it can be used as input to run
ARIBA. However, this was for just one of the many reference sequences of
interest, so we will delete it.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
rm\PY{+w}{ }\PYZhy{}r\PY{+w}{ }test.aribadb
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{using-all-reference-sequences}{%
\subsection{Using all reference
sequences}\label{using-all-reference-sequences}}

We need to deal with each of the reference sequences in turn by running
\texttt{ariba\ aln2meta} on each, like in the above example with
\textit{folP}. The only difference is that some of them are non-coding
sequences, which means that the command must have \texttt{noncoding}
instead of \texttt{coding}. For example:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }aln2meta\PY{+w}{ }\PYZhy{}\PYZhy{}variant\PYZus{}only\PY{+w}{ }aln2meta\PYZus{}input/16S.aln\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }aln2meta\PYZus{}input/16S\PYZus{}in.tsv\PY{+w}{ }noncoding\PY{+w}{ }aln2meta\PYZus{}output/16S
\end{Verbatim}
\end{tcolorbox}

    There are 10 coding sequences and two non-coding sequences. Instead of
writing 12 commands, we will use two `for loops'. First, the coding
sequences:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{for}\PY{+w}{ }x\PY{+w}{ }\PY{k}{in}\PY{+w}{ }folP\PY{+w}{ }gyrA\PY{+w}{ }mtrR\PY{+w}{ }parC\PY{+w}{ }parE\PY{+w}{ }penA\PY{+w}{ }ponA\PY{+w}{ }porB1b\PY{+w}{ }rpoB\PY{+w}{ }rpsJ
\PY{k}{do}
\PY{+w}{    }ariba\PY{+w}{ }aln2meta\PY{+w}{ }\PYZhy{}\PYZhy{}variant\PYZus{}only\PY{+w}{ }aln2meta\PYZus{}input/\PY{n+nv}{\PYZdl{}x}.aln\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }aln2meta\PYZus{}input/\PY{n+nv}{\PYZdl{}x}\PY{l+s+se}{\PYZbs{}\PYZus{}}in.tsv\PY{+w}{ }coding\PY{+w}{ }aln2meta\PYZus{}output/\PY{n+nv}{\PYZdl{}x}
\PY{k}{done}
\end{Verbatim}
\end{tcolorbox}

    And now the two non-coding sequences:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{for}\PY{+w}{ }x\PY{+w}{ }\PY{k}{in}\PY{+w}{ }16S\PY{+w}{ }23S
\PY{k}{do}
\PY{+w}{    }ariba\PY{+w}{ }aln2meta\PY{+w}{ }\PYZhy{}\PYZhy{}variant\PYZus{}only\PY{+w}{ }aln2meta\PYZus{}input/\PY{n+nv}{\PYZdl{}x}.aln\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }aln2meta\PYZus{}input/\PY{n+nv}{\PYZdl{}x}\PY{l+s+se}{\PYZbs{}\PYZus{}}in.tsv\PY{+w}{ }noncoding\PY{+w}{ }aln2meta\PYZus{}output/\PY{n+nv}{\PYZdl{}x}
\PY{k}{done}
\end{Verbatim}
\end{tcolorbox}

    This has generated three files for each sequence. We will combine these
to make input files for running \texttt{ariba\ prepareref}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
cat\PY{+w}{ }aln2meta\PYZus{}output/*.fa\PY{+w}{ }presence\PYZus{}absence/*.fa\PY{+w}{ }\PYZgt{}\PY{+w}{ }Ngo\PYZus{}ARIBA.fa
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
cat\PY{+w}{ }aln2meta\PYZus{}output/*.tsv\PY{+w}{ }presence\PYZus{}absence/presence\PYZus{}absence.tsv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZgt{}\PY{+w}{ }Ngo\PYZus{}ARIBA.tsv
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
cat\PY{+w}{ }aln2meta\PYZus{}output/*.cluster\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }presence\PYZus{}absence/presence\PYZus{}absence.clusters\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZgt{}\PY{+w}{ }Ngo\PYZus{}ARIBA.clusters
\end{Verbatim}
\end{tcolorbox}

    Finally, we have the three input files needed to make a single ARIBA
database that has information on all the sequences and SNPs of interest.
In case the directory is already there, we delete it first, then
generate the database:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
rm\PY{+w}{ }\PYZhy{}rf\PY{+w}{ }Ngo\PYZus{}ARIBAdb
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }prepareref\PY{+w}{ }\PYZhy{}f\PY{+w}{ }Ngo\PYZus{}ARIBA.fa\PY{+w}{ }\PYZhy{}m\PY{+w}{ }Ngo\PYZus{}ARIBA.tsv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZhy{}\PYZhy{}cdhit\PYZus{}clusters\PY{+w}{ }Ngo\PYZus{}ARIBA.clusters\PY{+w}{ }Ngo\PYZus{}ARIBAdb
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{cd}\PY{+w}{ }..
\end{Verbatim}
\end{tcolorbox}

    We now have a directory \texttt{Ngo\_ARIBAdb} that can be used as the
reference database when running \texttt{ariba\ run} on each sample.

Now move on to the next part of the tutorial where we
\href{run_ariba.ipynb}{run ARIBA using the custom reference data}.


    % Add a bibliography block to the postdoc



\newpage





    \hypertarget{run-ariba-using-a-custom-reference-database}{%
\section{Run ARIBA using a custom reference
database}\label{run-ariba-using-a-custom-reference-database}}

This shows how to run ARIBA on a large number of samples using a custom
reference database. To save time, this notebook does not actually run
any of the commands (each run of ARIBA takes a few minutes).

\hypertarget{reference-database}{%
\subsection{Reference database}\label{reference-database}}

First we need a reference database. You will already have one if you
followed the instructions in the previous part of this tutorial
(\href{make_custom_db.ipynb}{Prepare a custom reference data for
ARIBA}).

    \hypertarget{how-to-run-on-one-sample}{%
\subsection{How to run on one sample}\label{how-to-run-on-one-sample}}

ARIBA needs the database directory, which we have called
\texttt{Ngo\_ARIBAdb} in the \href{make_custom_db.ipynb}{previous
section of the tutorial}, and two sequencing reads files
\texttt{reads.1.fastq.gz}, \texttt{reads.2.fastq.gz}. The command to run
ARIBA is:

\begin{verbatim}
ariba run Ngo_ARIBAdb reads.1.fastq.gz reads.2.fastq.gz outdir
\end{verbatim}

The above command will make a new directory called \texttt{outdir} that
contains the results of matching the data for your sample
(reads.1.fastq.gz and reads.2.fastq.gz) against the database in
Ngo\_ARIBAdb.

    \hypertarget{run-on-all-samples}{%
\subsection{Run on all samples}\label{run-on-all-samples}}

The \textit{N. gonorrhoeae} dataset consists of 1517 samples, and we need
to run ARIBA on each sample, which can be done with a ``for'' loop. We
assume that the reads files are named like this:

\begin{verbatim}
ERR1067813.1.fq.gz ERR1067813.2.fq.gz
ERR1067814.1.fq.gz ERR1067814.2.fq.gz
ERR1067815.1.fq.gz ERR1067815.2.fq.gz
\end{verbatim}

Then we can run ARIBA on all samples like this (you may need to edit
this command depending on how your own fastq files are named):

\begin{verbatim}
for sample in `ls *.1.fq.gz | sed 's/\.1.fq.gz//'`
do
    ariba run Ngo_ARIBAdb $sample.1.fq.gz $sample.2.fq.gz $sample.ariba
done
\end{verbatim}

The output directory of each sample is called \texttt{\$sample.ariba},
for example ERR1067813.ariba is the output directory for sample
ERR1067813.

    \hypertarget{ariba-output}{%
\subsection{ARIBA output}\label{ariba-output}}

There is no need to run the commands in this section, they have already
been run and the results are found in the directory
\texttt{ARIBA\_reports}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls\PY{+w}{ }ARIBA\PYZus{}reports
\end{Verbatim}
\end{tcolorbox}

    Now go to the next part of the tutorial where we
\href{phandango.ipynb}{use Phandango to view the results}.


    % Add a bibliography block to the postdoc



\newpage





    \hypertarget{viewing-ariba-results-in-phandango}{%
\section{Viewing ARIBA results in
Phandango}\label{viewing-ariba-results-in-phandango}}

This section describes how to use
\href{http://phandango.net/}{Phandango} to view a summary of ARIBA
results from many samples.

The most important output file from ARIBA is the report called
\texttt{report.tsv}. For this tutorial, we have all 1517 reports in the
directory \texttt{ARIBA\_reports/}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls\PY{+w}{ }ARIBA\PYZus{}reports\PY{+w}{ }\PY{p}{|}\PY{+w}{ }wc\PY{+w}{ }\PYZhy{}l
\end{Verbatim}
\end{tcolorbox}

    As we have seen before, ARIBA has a functon called
``\href{https://github.com/sanger-pathogens/ariba/wiki/Task:-summary}{summary}''
that can summarise presence/absence of sequences and/or SNPs across
samples. It takes at least two ariba reports as input, and makes a CSV
file that can be opened in your favourite spreadsheet program, and also
makes input files for Phandango. The two Phandango files (a tree and a
CSV file) can be dropped straight into the Phandango page for viewing.

The tree that ARIBA makes is based on the CSV file, which contains
results of presence/absence of sequence and SNPs, and other information
such as percent identity bewteen contigs and reference sequences. This
means that it does not necessarily represent the real phylogeny of the
samples. It is more accurate to provide a tree built from the sequencing
data. For this reason, we will use a pre-computed tree file
\texttt{tree\_for\_phandango.tre}.

\hypertarget{basic-usage-of-ariba-summary}{%
\subsection{Basic usage of ariba
summary}\label{basic-usage-of-ariba-summary}}

First, let's run \texttt{ariba\ summary} using the default settings,
except we will skip making the tree:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }out\PY{+w}{ }ARIBA\PYZus{}reports/*.tsv
\end{Verbatim}
\end{tcolorbox}

    We can see that this made two files:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls\PY{+w}{ }out.*
\end{Verbatim}
\end{tcolorbox}

    They are the same except for the first line, which has
Phandango-specific information. ARIBA uses the filenames as sample names
in the output:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
head\PY{+w}{ }\PYZhy{}n\PY{+w}{ }\PY{l+m}{2}\PY{+w}{ }out.phandango.csv
\end{Verbatim}
\end{tcolorbox}

    The first name is ``ARIBA\_reports/ERR1067709.tsv'', and the rest are
named similarly. This is not ideal, as it will look ugly in Phandango.
Further, the names must exactly match the names in the tree file for
Phandango to work (have a look in the tree file
\texttt{data/tree\_for\_phandango.tre}). You could do a little hacking
here using the Unix command \texttt{sed} on the CSV file. Instead, we
can supply ARIBA with a file of filenames that also tells ariba what to
call the samples in its output CSV files. Instead of
``data/ARIBA\_reports/ERR1067709.tsv'', we would like to simply use
``ERR1067709'', which is cleaner and matches the tree file. It also
means we can (and will) repeatedly run \texttt{ariba\ summary} with
different options, and get output files that can be loaded straight into
Phandango. This is one way to make the file with the naming information:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ls\PY{+w}{ }ARIBA\PYZus{}reports/*\PY{+w}{ }\PY{p}{|}\PY{+w}{ }awk\PY{+w}{ }\PYZhy{}F/\PY{+w}{ }\PY{l+s+s1}{\PYZsq{}\PYZob{}print \PYZdl{}0,\PYZdl{}NF\PYZcb{}\PYZsq{}}\PY{+w}{ }\PY{p}{|}\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }sed\PY{+w}{ }\PY{l+s+s1}{\PYZsq{}s/.tsv\PYZdl{}//\PYZsq{}}\PY{+w}{ }\PYZgt{}\PY{+w}{ }filenames.fofn
\end{Verbatim}
\end{tcolorbox}

    The file is quite simple. Column 1 is the filename, and column 2 is the
name we would like to use in the output.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
head\PY{+w}{ }filenames.fofn
\end{Verbatim}
\end{tcolorbox}

    Now we can rerun summary using this input file. Note the use of the new
option \texttt{-\/-fofn}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }\PYZhy{}\PYZhy{}fofn\PY{+w}{ }filenames.fofn\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }out\PY{+w}{ }ARIBA\PYZus{}reports/*.tsv
\end{Verbatim}
\end{tcolorbox}

    Check that the renaming worked:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
head\PY{+w}{ }\PYZhy{}n\PY{+w}{ }\PY{l+m}{2}\PY{+w}{ }out.phandango.csv
\end{Verbatim}
\end{tcolorbox}

    Now go to \href{http://phandango.net/}{Phandango http://phandango.net}
and drag and drop the files \texttt{out.phandango.csv} and
\texttt{tree\_for\_phandango.tre} into the window. The result should
like this:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.phandango.default.png}
\caption{Default Layout}
\end{figure}

    This a very high-level summary of the data. For each cluster, it is
simply saying whether or not each sample has a `match'. Green means a
match, and pink means not a match. For presence/absence genes, this
means that the gene must simply be there to count as a match. If it is a
``variant only'' gene, then the gene must be there and one of the
variants that we told ARIBA about earlier when
\href{make_custom_db.ipynb}{generating the custom ARIBA database}.

    \hypertarget{more-information-per-cluster}{%
\subsection{More information per
cluster}\label{more-information-per-cluster}}

In addition to a simple ``yes'' or ``no'' as to whether a sample
``matches'' a given cluster (as explained above), more columns can be
output for each cluster. See the
\href{https://github.com/sanger-pathogens/ariba/wiki/Task:-summary}{ARIBA
summary wiki page} for a full description of the options.

Adding more columns can result in a very wide plot, so we will just look
at 23S from now on, using the option \texttt{-\/-only\_clusters\ 23S}.
Adding the option \texttt{-\/-preset\ all} will show all available
columns for the 23S cluster:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}only\PYZus{}clusters\PY{+w}{ }23S\PY{+w}{ }\PYZhy{}\PYZhy{}preset\PY{+w}{ }cluster\PYZus{}all\PY{+w}{ }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{  }\PYZhy{}\PYZhy{}fofn\PY{+w}{ }filenames.fofn\PY{+w}{ }out\PY{+w}{ }ARIBA\PYZus{}reports/*.tsv
\end{Verbatim}
\end{tcolorbox}

    As before, drag and drop the files \texttt{out.phandango.csv} and
\texttt{tree\_for\_phandango.tre} into the window. This time the result
should look like this:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.phandango.23S.cluster_all.png}
\caption{Phandango 23S cluster\_all}
\end{figure}

    Now there are seven columns, showing various findings from ARIBA for
23S. These columns are described in the
\href{https://github.com/sanger-pathogens/ariba/wiki/Task:-summary}{ARIBA
summary wiki page}.

You can control exactly which of the seven cluster columns are output
using the option \texttt{-\/-cluster\_cols} instead of
\texttt{-\/-preset}. For example, this will show just the ``match'' and
``pct\_id'' columns:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}only\PYZus{}clusters\PY{+w}{ }23S\PY{+w}{ }\PYZhy{}\PYZhy{}cluster\PYZus{}cols\PY{+w}{ }match,pct\PYZus{}id\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }\PYZhy{}\PYZhy{}fofn\PY{+w}{ }filenames.fofn\PY{+w}{ }out\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }ARIBA\PYZus{}reports/*.tsv
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{variants}{%
\subsection{Variants}\label{variants}}

In the previous screenshot, where the option
\texttt{-\/-preset\ cluster\_all}, there are two variant columns:
``known\_var'' and ``novel\_var''. Green means ``yes'' and pink means
``no''. Here, we are considering a variant to be a difference bewteen
the reference sequence and the assembly contig from the reads. The
known\_var column indicates whether each sample has any variant that is
known to ARIBA, which means it was included when the original ARIBA
database was generated. The novel\_var column indicates whether or not a
sample has any variant that is not already known to ARIBA.

We can view the calls for all the known variants by adding the
\texttt{-\/-known\_variants} option:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}only\PYZus{}clusters\PY{+w}{ }23S\PY{+w}{ }\PYZhy{}\PYZhy{}known\PYZus{}variants\PY{+w}{ }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{  }\PYZhy{}\PYZhy{}fofn\PY{+w}{ }filenames.fofn\PY{+w}{ }out\PY{+w}{ }ARIBA\PYZus{}reports/*.tsv
\end{Verbatim}
\end{tcolorbox}

    As before, drag and drop the files \texttt{out.phandango.csv} and
\texttt{tree\_for\_phandango.tre} into the window. This time the result
should like this:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.phandango.23S.known_vars.png}
\caption{Phandango 23S known\_variants}
\end{figure}

    Each known SNP and whether or not it is present is shown, but you may
have noticed there are three colours. Green means ``yes'', orange means
``heterozygous'', and pink means ``no''. \textit{N. gonorrhoeae} has four
copies of 23S. A SNP could be present in none, some, or all copies.
Where it is present in 1,2, or 3 copies, it is called ``heterozygous''
by ARIBA. Consider the SNP 2597CT in column 4, and column 5 to the right
``2597CT.\%''. Samples either do not have this SNP, or have heterozygous
calls. The 2597CT.\% shows the percent of reads that have the SNP, when
mapped to the contig. Hover over the coloured blocks in Phandango to see
the percentage.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}only\PYZus{}clusters\PY{+w}{ }23S\PY{+w}{ }\PYZhy{}\PYZhy{}novel\PYZus{}variants\PY{+w}{ }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{  }\PYZhy{}\PYZhy{}fofn\PY{+w}{ }filenames.fofn\PY{+w}{ }out\PY{+w}{ }ARIBA\PYZus{}reports/*.tsv
\end{Verbatim}
\end{tcolorbox}

    Now Phandango shows all variants found in any of the samples (even if
the variant is unique to one sample). This results in a lot of columns!

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.phandango.23S.novel_vars.png}
\caption{Phandango 23S novel\_variants}
\end{figure}

    Now go to the next part of the tutorial where we
\href{micplot.ipynb}{Investigate MIC data in relation to variants in the
samples}.


    % Add a bibliography block to the postdoc



\newpage





    \hypertarget{investigating-mic-data}{%
\section{Investigating MIC data}\label{investigating-mic-data}}

We will use the \textit{N. gonorrhoeae} dataset again. This tutorial
includes pre-computed output of running ARIBA on all the samples, and
the ARIBA database that was made in the
\href{make_custom_db.ipynb}{earlier section}.

ARIBA has a function called ``micplot'' that generates plots showing the
distribution of MICs across samples with different combinations of
genotypes. To use it, a file is required of MIC data for each sample and
at least one drug. It looks like this:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
head\PY{+w}{ }mic\PYZus{}data.tsv
\end{Verbatim}
\end{tcolorbox}

    The first column must be named ``Sample'' and have names that exactly
match those in ARIBA summary files used as input to micplot (we will see
this shortly). The remaining columns should contain drug names and MIC
scores, however, note that the first two columns contain other data that
will be ignored by ARIBA. When ARIBA loads the file, it tries to convert
everything in columns 2 onwards to numbers and assign a value of ``NA''
when this is not possible.

To run micplot, we need an MIC file, like the one above, and an ARIBA
summary file (as described in the \href{phandango.ipynb}{previous
section}). This generates a summary of known 23S and mtrR mutations and
includes the ``assembled'' cluster column, so that interrupted mtrR can
be identified:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }summary\PY{+w}{ }\PYZhy{}\PYZhy{}row\PYZus{}filter\PY{+w}{ }n\PY{+w}{ }\PYZhy{}\PYZhy{}cluster\PYZus{}cols\PY{+w}{ }assembled,known\PYZus{}var\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZhy{}\PYZhy{}only\PYZus{}clusters\PY{+w}{ }23S,mtrR\PY{+w}{ }\PYZhy{}\PYZhy{}v\PYZus{}groups\PY{+w}{ }\PYZhy{}\PYZhy{}no\PYZus{}tree\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZhy{}\PYZhy{}fofn\PY{+w}{ }filenames.fofn\PY{+w}{ }summary.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    Now we can run micplot using the new file
\texttt{summary.AZMknowngroups.csv} and the MIC file
\texttt{mic\_data.tsv}, showing the MIC data for azithromicin compared
with the different combinations of sequences and known mutations in 23S
and mtrR:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }Azithromycin\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }mic\PYZus{}data.tsv\PY{+w}{ }summary.AZMknowngroups.csv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    This produced a pdf file \texttt{micplot.AZMknowngroups.pdf} that looks
like this:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.png}
\caption{micplot AZMknowngroups}
\end{figure}

    There are various options that can be changed. We will show some of them
here, but try running \texttt{ariba\ micplot\ -\/-help} to see all the
options.

\hypertarget{horizontal-lines}{%
\subsection{Horizontal lines}\label{horizontal-lines}}

Horizontal lines can be added to indicate import cutoffs for MIC data,
in this case 0.25 and 2, using the option \texttt{-\/-hlines}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }\PYZhy{}\PYZhy{}hlines\PY{+w}{ }\PY{l+m}{0}.25,2\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }Azithromycin\PY{+w}{ }mic\PYZus{}data.tsv\PY{+w}{ }summary.AZMknowngroups.csv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    Here is the result:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.hlines.png}
\caption{micplot hlines}
\end{figure}

    \hypertarget{plot-styles}{%
\subsection{Plot styles}\label{plot-styles}}

In the plots above, there is one point per sample. It can be hard to see
how many points there are, despite there being jittering applied to the
horizontal position. We can change the style to group the points
together and plot circles of sizes proportional to the number of
samples, using the option \texttt{-\/-point\_size}. This option
determines the size of the points, but when set to zero if groups the
points together.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }\PYZhy{}\PYZhy{}hlines\PY{+w}{ }\PY{l+m}{0}.25,2\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }\PYZhy{}\PYZhy{}point\PYZus{}size\PY{+w}{ }\PY{l+m}{0}\PY{+w}{ }Azithromycin\PY{+w}{ }mic\PYZus{}data.tsv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{    }summary.AZMknowngroups.csv\PY{+w}{ }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    Here is the result:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.point_zero.png}
\caption{micplot point size zero}
\end{figure}

    You can choose to not show the violin plots or the dots in the upper
plot, using the option \texttt{-\/-plot\_types}. The default is
\texttt{violin,point}, which means show both. To only show the dots:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }\PYZhy{}\PYZhy{}hlines\PY{+w}{ }\PY{l+m}{0}.25,2\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }\PYZhy{}\PYZhy{}plot\PYZus{}types\PY{+w}{ }point\PY{+w}{ }\PYZhy{}\PYZhy{}point\PYZus{}size\PY{+w}{ }\PY{l+m}{0}\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }Azithromycin\PY{+w}{ }mic\PYZus{}data.tsv\PY{+w}{ }summary.AZMknowngroups.csv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    Here is the result:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.dots_only.png}
\caption{micplot dots only}
\end{figure}

    \hypertarget{colours}{%
\subsection{Colours}\label{colours}}

There are various colour options - see the
\href{http://matplotlib.org/users/colormaps.html}{matplotlib colourmaps
page} for all of the available colour palettes. The default is
``Accent'', which has 8 colours. ARIBA will cycle through these,
repeating colours if there are more than 8 columns in the plot. The
palette can be changed using the option \texttt{-\/-colourmap}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }\PYZhy{}\PYZhy{}hlines\PY{+w}{ }\PY{l+m}{0}.25,2\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }\PYZhy{}\PYZhy{}colourmap\PY{+w}{ }PiYG\PY{+w}{ }\PYZhy{}\PYZhy{}point\PYZus{}size\PY{+w}{ }\PY{l+m}{0}\PY{+w}{ }Azithromycin\PY{+w}{ }mic\PYZus{}data.tsv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }summary.AZMknowngroups.csv\PY{+w}{ }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    Here is the result:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.PiYG.png}
\caption{micplot PiYG}
\end{figure}

    The palette PiYG is continuous, and is almost white in the middle. This
is not ideal. We can skip the range in the middle, specifically 40-60\%,
using the option \texttt{-\/-colour\_skip}:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }\PYZhy{}\PYZhy{}hlines\PY{+w}{ }\PY{l+m}{0}.25,2\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }\PYZhy{}\PYZhy{}colourmap\PY{+w}{ }PiYG\PY{+w}{ }\PYZhy{}\PYZhy{}colour\PYZus{}skip\PY{+w}{ }\PY{l+m}{0}.35,0.65\PY{+w}{ }\PYZhy{}\PYZhy{}point\PYZus{}size\PY{+w}{ }\PY{l+m}{0}\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }Azithromycin\PY{+w}{ }mic\PYZus{}data.tsv\PY{+w}{ }summary.AZMknowngroups.csv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    Here is the new plot:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.colour_skip.png}
\caption{micplot colour\_skip}
\end{figure}

    The number of colours can be set to less than the number of columns
using the option \texttt{-\/-number\_of\_colours}. This makes ARIBA
cycle the colours. Here is an example using the first three colours from
the ``Dark2'' colour palette:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }\PYZhy{}\PYZhy{}hlines\PY{+w}{ }\PY{l+m}{0}.25,2\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }\PYZhy{}\PYZhy{}colourmap\PY{+w}{ }Dark2\PY{+w}{ }\PYZhy{}\PYZhy{}number\PYZus{}of\PYZus{}colours\PY{+w}{ }\PY{l+m}{3}\PY{+w}{ }\PYZhy{}\PYZhy{}point\PYZus{}size\PY{+w}{ }\PY{l+m}{0}\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }Azithromycin\PY{+w}{ }mic\PYZus{}data.tsv\PY{+w}{ }summary.AZMknowngroups.csv\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    And we only have three colours:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.3colours.png}
\caption{micplot 3 colours}
\end{figure}

    Setting the number of colours to one results in a black and white
figure.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
ariba\PY{+w}{ }micplot\PY{+w}{ }Ref/Ngo\PYZus{}ARIBAdb/\PY{+w}{ }\PYZhy{}\PYZhy{}interrupted\PY{+w}{ }\PYZhy{}\PYZhy{}hlines\PY{+w}{ }\PY{l+m}{0}.25,2\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }\PYZhy{}\PYZhy{}number\PYZus{}of\PYZus{}colours\PY{+w}{ }\PY{l+m}{1}\PY{+w}{ }\PYZhy{}\PYZhy{}point\PYZus{}size\PY{+w}{ }\PY{l+m}{0}\PY{+w}{ }Azithromycin\PY{+w}{ }\PY{l+s+se}{\PYZbs{}}
\PY{+w}{ }mic\PYZus{}data.tsv\PY{+w}{ }summary.AZMknowngroups.csv\PY{+w}{ }micplot.AZMknowngroups
\end{Verbatim}
\end{tcolorbox}

    Here is the black and white figure:

    \begin{figure}
\centering
\includegraphics{Screenshots/screenshot.micplot.AZMknowngroups.blackwhite.png}
\caption{micplot black and white}
\end{figure}

    Congratultaions, you have reached the end of the tutorial!


    % Add a bibliography block to the postdoc



\end{document}
